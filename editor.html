<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor</title>

      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!--Bootstrap Link-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  
     <!--Favicon-->
    <link rel="icon" type="image/png" href="images/WhatsApp_Image_2024-10-14_at_9.50.23_AM__1_-removebg-preview.png">
    <!--for box icons-->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
     <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'><!--for box icons-->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet"><!--for scroll animation-->
    
<!--Code Mirror-->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/addon/hint/show-hint.css">
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/addon/hint/show-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/addon/hint/anyword-hint.js"></script>

<!--Theme-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/theme/material.css"> 


<script src="https://cdnjs.cloudflare.com/ajax/libs/postcss/8.4.5/postcss.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/acorn/8.4.1/acorn.min.js"></script>

<!--CSS and JS Connection Links-->
<link rel="stylesheet" href="editor.css">
     <script type="module" src="editor.js"></script>



    
</head>
<body>
     <header>
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <div class="heading">
        <img src="images/WhatsApp_Image_2024-10-14_at_9.50.23_AM__1_-removebg-preview.png" alt="logo" class="icon-image">
      <h1 class="navbar-brand">CODE SPEAK</h1>
      </div>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navnav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navnav">
        <ul class="navbar-nav ms-auto">
          <!-- Auth Buttons (Visible When User is Not Logged In) -->
          <li class="nav-item save-btn">
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModalCenter">Shortcuts</button>
            <button class="btn btn-success" data-bs-toggle="modal" id="save-button">Save</button>
           <li class="nav-item register-btn" id="auth-buttons" >
             <button class="btn btn-danger" onclick="window.location.href='signup.html'">SignUp</button>
            <button class="btn btn-primary" onclick="window.location.href='login.html'">Log in</button>
           </li>
          </li>

          <!-- User Icon (Initially Hidden) -->
          <li class="nav-item dropdown" id="user-dropdown" style="display: none;">
            <a class="nav-link" href="#" id="userIcon">
              <i class="fa-solid fa-user"></i> <!-- FontAwesome User Icon -->
            </a>
            <div class="dropdown-menu" id="user-menu">
              <span class="dropdown-item" id="username-display"></span>
              <button class="dropdown-item text-danger" id="logout-btn">Logout</button>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>

         <!-- fancy border -->
<div class="fancy-border1">

</div>

<main>
    <!--Code Editor-->
  <section class="container2">
   
<div class="editor">

<div class="left">

<div>
    <!--HTML Area-->
      <label><i class='bx bxl-html5'></i>HTML   

      <span id="html-error-icon" class="emoji" style="display: none;">ðŸš«</span>
     

  </label>
  <!--  <textarea name="html" id="html-code" spellcheck="false" onkeyup="run()"></textarea>  -->
  <div id="html-code" class="code-editor"  onkeyup="run()"></div>
 <div class="error-messages">
      <div id="html-error-messages" class="error-message" style="display: none;"></div>
    </div>
</div>
  <!--CSS Area-->
<div>
    
  <label><i class='bx bxl-css3' ></i>CSS 
    <span id="css-error-icon" class="emoji" style="display: none;">ðŸš«</span>
 
  </label>
  <!--  <textarea name="css" id="css-code"  spellcheck="false" onkeyup="run()"></textarea>  -->
     <div id="css-code" class="code-editor"  onkeyup="run()"></div>
      <div class="error-messages">
  <div id="css-error-messages" class="error-message" style="display: none;"></div>
</div>
</div>

     
  <!--JS Area-->

<div>
      <label><i class='bx bxl-javascript' ></i>JS  
      <span id="js-error-icon" class="emoji" style="display: none;">ðŸš«</span>

  
        </label>
  </label>
  
 <!--  <textarea name="css" id="js-code"  spellcheck="false" onkeyup="run()"></textarea>  -->
    <div id="js-code" class="code-editor"  onkeyup="run()"></div>

   <div class="error-messages">
  <div id="js-error-messages" class="error-message" style="display: none;"></div>
 
</div>
</div>
</div>

<!--Output Area-->
<div class="right">
  <label class="right-label">
   <p><i class='bx bx-play'></i> Output</p>
 <div class="output-icons">
   <button class="save-btn">  <a href="save-codes.html"><i class="fas fa-save"></i> Saved Codes </a> </button>

    <button id="speak-errors" ><i class="fa fa-volume-up" ></i> Errors</button>
 </div>
  </label>
  <iframe id="output" class="outputs"></iframe>

 
 
</div>



</div>

  </section>

  <!--Save Button Modal-->

 <section>

<!-- Login/Signup Modal -->
<div class="modal fade" id="addTaskModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalLabel">Login Required</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>You must log in to save your code.</p>
        <a href="login.html" class="btn btn-primary">Login</a>
        <a href="signup.html" class="btn btn-secondary">Sign Up</a>
      </div>
    </div>
  </div>
</div>

 </section>


 

<!-- Shortcuts button Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    
                  <div class="modal-dialog">
                    <div class="modal-content modal-content2">
                        <div class="modal-header">
                            <h2 class="modal-title modal-title2">Editor Shortcuts</h2>
                           
                            <button type="button" class="btn btn-close" data-bs-dismiss="modal"></button>
                        </div>
                       <div class="modal-content modal-content3 modal-para">  <h5 class="modal-para1"><span class="shortcuts">Ctrl + A</span> &nbsp;&nbsp;  Select All</h5></div>
                    
                       <div class="modal-content  modal-content3 modal-para">  <h5 class="modal-para1"><span class="shortcuts">Ctrl + Space</span> &nbsp;&nbsp; Autocomplete</h5></div>
                    
                       <div class="modal-content modal-content3 modal-para">  <h5 class="modal-para1"><span class="shortcuts">Ctrl + D</span> &nbsp;&nbsp; Duplicate Line</h5></div>
                    
                       <div class="modal-content modal-content3 modal-para">  <h5 class="modal-para1"><span class="shortcuts">Ctrl + F</span> &nbsp;&nbsp; Find</h5></div>
                    
       
    </div>
  </form>
                        </div>
                      
                    </div>
                  </div>
             </div>

    </div>



</main>

<script>
 document.getElementById("save-button").addEventListener("click", async function () {
  const userToken = localStorage.getItem("token");
console.log(userToken)
if (!userToken || userToken === "undefined" || userToken === "null") {
  // Show the login/signup modal if the user is not logged in
  const modal = new bootstrap.Modal(document.getElementById("addTaskModal"));
  modal.show();
  return;
}

  // Since `#html-code`, `#css-code`, and `#js-code` are <div> elements, use .innerText instead of .value
  const htmlCode = document.getElementById("html-code")?.innerText.trim() || "";
  const cssCode = document.getElementById("css-code")?.innerText.trim() || "";
  const jsCode = document.getElementById("js-code")?.innerText.trim() || "";

  console.log("Sending Code Data:", { html: htmlCode, css: cssCode, js: jsCode });

  try {
    const response = await fetch("http://localhost:5000/save-code", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${userToken}`,
      },
      body: JSON.stringify({
        html: htmlCode,
        css: cssCode,
        js: jsCode,
      }),
    });

    const data = await response.json();

    if (response.ok) {
      alert("Code saved successfully!");
    } else {
      alert(data.message);
    }
  } catch (error) {
    console.error("Error saving code:", error);
    alert("Something went wrong. Please try again.");
  }
});



</script>

<script>
  document.addEventListener("DOMContentLoaded", async function () {
  const userDropdown = document.getElementById("user-dropdown"); // User icon
  const authButtons = document.getElementById("auth-buttons"); // Login/Signup buttons
  const usernameDisplay = document.getElementById("username-display"); // Username display
  const logoutBtn = document.getElementById("logout-btn"); // Logout button

  function updateUI() {
    const token = localStorage.getItem("token");
    const username = localStorage.getItem("username");

    if (token && username) {
      usernameDisplay.textContent = username; // Set username text
      userDropdown.style.display = "block"; // Show user icon
      authButtons.style.display = "none"; // Hide login/signup buttons
    } else {
      userDropdown.style.display = "none"; // Hide user icon
      authButtons.style.display = "block"; // Show login/signup buttons
    }
  }

  async function fetchUserProfile() {
    const token = localStorage.getItem("token");
    if (!token) return;

    try {
      const response = await fetch("http://localhost:5000/user-profile", {
        method: "GET",
        headers: { Authorization: `Bearer ${token}` },
      });

      if (response.ok) {
        const userData = await response.json();
        localStorage.setItem("username", userData.username); // Ensure username is stored
        updateUI(); // Update UI after fetching user data
      }
    } catch (error) {
      console.error("Error fetching profile:", error);
    }
  }

  updateUI(); // Call function on page load
  fetchUserProfile(); // Fetch user data if token is present

  // Logout Functionality
  logoutBtn.addEventListener("click", function () {
    localStorage.removeItem("token");
    localStorage.removeItem("username");
    updateUI(); // Update UI after logout
    alert("Logged out successfully!");
    window.location.href = "index.html"; // Redirect to homepage
  });
});

</script>

 <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script><!--for scroll animation-->

        
<script>AOS.init();</script><!--scroll animation-->

        <script src="https://unpkg.com/typed.js@2.1.0/dist/typed.umd.js"></script>  <!--for type animation-->

<!--Bootstrap JS links-->
     <script src="https://cdn.jsdelivr.net/npm/@floating-ui/core@1.6.5"></script>
<script src="https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.6.8"></script>
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
 
</body>
</html>